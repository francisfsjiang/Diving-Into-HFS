\chapter{Review要务}
\label{ch:review}

\section{默认导出条件}

一份JavaDoc文档被导出成为报告的一部分, 当且仅当:

\begin{centering}
    \begin{enumerate}
        \item 注释中含有中文或其他非西文字符
        \item 注释隶属于类或者方法, 且与紧随其后的类或者方法之间不留空行
        \item 没有通过添加``@@''被显式的禁止导出
    \end{enumerate}
\end{centering}

\section{默认导出内容}

默认的导出内容包括

\begin{centering}
    \begin{enumerate}
        \item JavaDoc正文
        \item 方法的modifier, 即public/private/protected
        \item 方法返回类型, 构造方法的返回类型视作当前类
    \end{enumerate}
\end{centering}

\section{手动禁止导出}

向JavaDoc内部任意位置添加``@@''(不含引号)即可禁止导出.

\section{Review要务}

Review中的核心要务总结如下:

对照第\ref{ch:demo}章中渲染出的样例, 和随本文档发布的AFS.java,
对现有文档做以下修改:

\begin{centering}
    \begin{enumerate}
        \item 参考导出后的格式, 修正文档行文格式, 使适合报告文体
        \item \textcolor{red}{删除<code></code>之外的所有HTML标签, 只留标签内部内容}
        \item \textcolor{orange}{删除所有不准备导出导出的英文原文}
        \item \textcolor{yellow}{删除或者折叠占据多行的JavaDoc Tags}
        \item \textcolor{green}{同一系的重载方法, 合并所有文档其中任意一个方法上, 并禁止导出其他}
        \item \textcolor{cyan}{统一到UTF-8编码}
        \item \textcolor{blue}{在Tower.im上标注作者和复核人, 那张表格是生成作者信息的依据}
        \item \textcolor{violet}{注释中对所有类名的引用, 改写成{@link Clazz}或者\emph{Clazz}的形式}
    \end{enumerate}
\end{centering}

\chapter{XGen说明}

首先, 这个导出工具暂拟命名XGeb, 不出意外的话应该是没时间给它改名字了.
它依赖Eclipse JDT, 用于将Java源代码解析成逻辑结构.

\section{导出的先决条件}

注意: 当且仅当一份JavaDoc注释
属于类或方法
包含中文或其他非\emph{ACSII}字符
不包含``@@''
时, 该JavaDoc才会被导出.

完成复核之后, 不需要被导出的Javadoc, 在任意地方添加``@@''即可略过.

\section{XGen的内部机制与应对策略}

\section{JavaDoc的捕获}

XGen捕获JavaDoc的核心是, JDT的解析结果中, JavaDoc不会被纳入行号计数.
这意味着, 当一段JavaDoc和紧邻其后的类或方法之间没有空行的时候,
这个类或者方法的开始行数和JavaDoc的开始行数是相同的.

XGen两次遍历语法树, 每个pass处理的任务分别为
\begin{centering}
    \begin{enumerate}
        \item 捕获所有JavaDoc及其行号, 同时对JavaDoc进行预处理
        \item 捕获所有类/方法的定义, 尝试找出对应的JavaDoc
    \end{enumerate}
\end{centering}

所以, JavaDoc和紧邻其后的类或方法之间不要留空行.

\section{预处理}

XGen的预处理流程如下

\begin{centering}
    \begin{enumerate}
        \item 如果文本不含中文, 直接丢弃
        \item 删除注释用的/**, *和*/
        \item 删除所有独立tags, 比如@param
        \item 替换<code></code>和{@link Clazz{\#}method}成LaTeX中的\emph{}
    \end{enumerate}
\end{centering}

JavaDoc的原文会被全部导出, 因此需要移除非必要的文本.
注意, 正则表达式并不能完成解析HTML这样的工作, 所以请手动移除\emph{code}之外的其他标签.

\section{导出}

XGen导出的内容包括

\begin{centering}
    \begin{enumerate}
        \item JavaDoc正文
        \item 方法的modifier, 即public/private/protected
        \item 方法返回类型, 构造方法的返回类型视作当前类
    \end{enumerate}
\end{centering}

注意, 不导出参数列, 因为J系语言名字太长, 加上参数列根本没地方印.
因为不导出参数列, 所以并不能区分重载方法.
因为不区分重载方法, 所以, 重载方法的所有文档集合到一处便是.

\chapter{渲染示例}
\label{ch:demo}

\input{example/gen}
